define(["jquery","ekyna-modal","ekyna-table","select2"],function(a,b,c){"use strict";return a.fn.entityWidget=function(){return this.each(function(){var d=a(this),e=d.find("button.new-resource"),f=d.find("button.list-resource"),g=d.find("select");1===e.length&&e.bind("click",function(){var c=new b;c.load({url:e.data("path")}),a(c).on("ekyna.modal.response",function(b){if("json"===b.contentType){b.preventDefault();var c=b.content,d=a("<option />");if(d.prop("value",c.id),d.prop("selected",!0),void 0!==c.choice_label)d.html(c.choice_label);else if(void 0!==c.name)d.html(c.name);else{if(void 0===c.title)throw"Unexpected resource data.";d.html(c.title)}g.find("option").prop("selected",!1),g.append(d).trigger("change"),b.modal.close()}})}),1===f.length&&f.bind("click",function(){var d=new b;d.load({url:f.data("path")}),a(d).on("ekyna.modal.content",function(b){if("table"!==b.contentType)throw"Expected modal content type = 'table'.";c.create(b.content,{ajax:!0,onSelection:function(b){g.prop("multiple")&&g.find("option").prop("selected",!1),a(b).each(function(b,c){var d=g.find("option[value="+c.id+"]");1===d.length?d.prop("selected",!0):(d=a("<option />"),d.prop("value",c.id),d.prop("selected",!0),void 0!==c.choice_label?d.html(c.choice_label):void 0!==c.name?d.html(c.name):void 0!==c.title?d.html(c.title):d.html("Entity #"+c.id),g.append(d))}),g.trigger("change"),d.getDialog().close()}})})})}),this},{init:function(a){a.entityWidget()}}});